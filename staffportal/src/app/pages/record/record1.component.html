<div *ngIf="createrecord=== true">
<div class="header pb-8 pt-lg-8 d-flex align-items-center" style="min-height: 50px;">
  <!-- Mask -->
  <span class="mask bg-gradient-info opacity-8"></span>
  
</div>
<div class="container-fluid mt--7">
  <div class="row">
    <div class="col-xl-8 order-xl-1">
      <div class="card bg-secondary shadow">
        <div class="card-header bg-white border-0">
          <div class="row align-items-center">
            <div class="col-4">
              <a class="text-dark text-center" (click)="backtoMenu()"><i
                class="fas fa-backward"></i><b> Back</b></a>
            </div>
                  <h5 class="mb-0">Add Labour Record</h5>
                <div class="col-4">
                  <span class="btn-warning btn-sm float-right">
                    {{ date | date: "dd-MM-yyyy" }}
                  </span>
              </div>
          </div>
        </div>
        <div class="card-body">
          <div class="form-group">
            <label class="form-control-label " for="input-state">State: &nbsp;</label>
        <select (change)="onstateChange()" [(ngModel)]="state" class="btn btn-pill"
                    style="background: white;padding:4px !important">
                    <option [ngValue]="undefined" disabled>Select State</option>
                    <option *ngFor="let state of stateslist" [value]="state">{{state}}</option>
        </select>
          </div>
          <div class="form-group">
            <label class="form-control-label " for="input-city">City: &nbsp;</label>
        <select (change)="oncityChange()" [(ngModel)]="selectedcity" class="btn btn-pill"
                    style="background: white;padding:4px !important">
                    <option [ngValue]="undefined" disabled>Select City</option>
                    <option *ngFor="let city of citylist" [value]="city">{{city}}</option>
        </select>
          </div>
        <div class="form-group">
          <label class="form-control-label " for="input-project">Project: &nbsp;</label>
        <div class="dropdown label">
          <input 
            type="text" 
            placeholder="Search Projects" 
            [(ngModel)]="searchQuery" 
            (focus)="showDropdown = true" 
            (input)="filterProjects()" 
            (blur)="hideDropdown()" 
            style="width: 100%; padding: 4px; margin-bottom: 4px;"
          />
        
          <div class="dropdown-list" *ngIf="showDropdown">
            <div 
              *ngFor="let project of filteredProjects" 
              (click)="selectProject(project.projectname)" 
              class="dropdown-item"
            >
              {{ project.projectname }}
            </div>
          </div>
        </div>
        </div>
        <div *ngIf="projectselected===true" class="form-group">
          <form #expForm="ngForm">
            <div class="pl-lg-4">
              <div class="row">
                <div class="col-lg-6">
                  <div class="form-group">
                    <label class="form-control-label " for="input-projectNo">Project No: &nbsp;</label>
                    <label class="form-control-label " for="input-projectNumber">{{selectedProject.projectnumber}}</label>
                  </div>
                </div>
              </div>
            </div>
            <div class="pl-lg-4">
              <div class="row">
                <div class="col-lg-6">
                  <div class="form-group">
                    <label class="form-control-label " for="sprojectfloor">Slab: &nbsp;</label>
                    <select id="sprojectfloor" name="sprojectfloor"  (change)="onfloorChange()"  class="btn btn-pill" [(ngModel)]="sprojectfloor"
                     style="background: white;padding:4px !important" required #sprojectfloorcontrol="ngModel">
                      <option value="undefined" disabled>Select Slab</option>
                      <option *ngFor="let floor of floors" >{{floor}}</option>
                    </select>
                    <span class="text-danger" *ngIf="sprojectfloorcontrol.touched && sprojectfloorcontrol.invalid">
                      Select Slab
                    </span>
                  </div>
                </div>
                <div class="col-lg-6">
                  <div class="form-group">
                    <label class="form-control-label " for="sprojectpour">Pour: &nbsp;</label>
                    <select id="sprojectpour" name="sprojectpour" (change)="onpourChange()"  class="btn btn-pill" [(ngModel)]="sprojectpour"
                     style="background: white;padding:4px !important" required #sprojectpourcontrol="ngModel">
                      <option [ngValue]="undefined" disabled>Select Pour</option>
                      <option *ngFor="let pour of pours">{{pour}}</option>
                    </select>
                    <span class="text-danger" *ngIf="sprojectpourcontrol.touched && sprojectpourcontrol.invalid">
                      Select Pour
                    </span>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-lg-6">
                  <div class="form-group">
                    <label class="form-control-label " for="sworktype">Work: &nbsp;</label>
                    <select id="sworktype" name="sworktype" (change)="onworkChange()"  class="btn btn-pill" [(ngModel)]="sworktype"
                     style="background: white;padding:4px !important" required #sprojectwpcontrol="ngModel">
                    <option [ngValue]="undefined" disabled>Select WorkType</option>
                    <option *ngFor="let worktype of worktypes">{{worktype}}</option>
                    </select>
                    <span class="text-danger" *ngIf="sprojectwpcontrol.touched && sprojectwpcontrol.invalid">
                      Select WorkType
                    </span>
                  </div>
                </div>
                <div class="col-lg-6">
                  <div class="form-group">
                    <label class="form-control-label">Number of Workers:</label>
                    <div class="row">
                      <div class="col-md-4 mb-2">
                        <input type="number" class="form-control"
                               name="companyWorker"
                               placeholder="Enter Company Worker Count"
                               [(ngModel)]="companyWorker"
                               #companyWorkerControl="ngModel"
                               [ngClass]="{'is-invalid': !isAnyWorkerCountValid && !companyWorker}">
                      </div>
                      <div class="col-md-4 mb-2">
                        <input type="number" class="form-control"
                               name="contractWorker"
                               placeholder="Enter Contract Worker Count"
                               [(ngModel)]="contractWorker"
                               #contractWorkerControl="ngModel"
                               [ngClass]="{'is-invalid': !isAnyWorkerCountValid && !contractWorker}">
                      </div>
                      <div class="col-md-4 mb-2">
                        <input type="number" class="form-control"
                               name="others"
                               placeholder="Enter Others Count"
                               [(ngModel)]="others"
                               #othersControl="ngModel"
                               [ngClass]="{'is-invalid': !isAnyWorkerCountValid && !others}">
                      </div>
                    </div>
                  </div>     
                  <div class="form-group">
                    <label class="form-control-label">Upload File:</label>
                    <label class="btn btn-primary w-100 m-0" style="cursor: pointer;">
                      Select Files
                      <input
                        type="file"
                        hidden
                        multiple
                        (change)="onFileSelected($event)"
                        [ngModelOptions]="{ standalone: true }"
                      >
                    </label>
                  
                    <!-- Display selected file names -->
                    <ul class="mt-2" *ngIf="fileDetails.length > 0">
                      <li *ngFor="let file of fileDetails; let i = index" class="text-muted">
                        {{ i + 1 }}. {{ file.name }} ({{ (file.size / 1024).toFixed(1) }} KB)
                        <button type="button" class="btn btn-sm btn-danger ml-2" (click)="removeFile(i)">Remove</button>
                      </li>
                    </ul>
                  </div>                  
                </div>               
              </div>
            </div>
            <div class="text-center">
              <button title="Fill Expenses" [disabled]="expForm.invalid || !isAnyWorkerCountValid"  type="button" class="btn btn-success my-4" (click)="recordlabour()">
                Submit</button>
            </div>
          </form>
        </div>
      </div>
      </div>
    </div>
  </div>
</div>
</div>
<div *ngIf="submit=== true">
  <div class="header bg-gradient-info pb-8 pt-5">
    <div class="container-fluid">
      <div class="header-body">
        <div class="col-sm-8 text-center">
          <h3 class="text-white">Staff Portal by UPTS/PMSS</h3>
        </div>
      </div>
    </div>
  </div>
  <!-- Page content -->
  <div class="container-fluid mt--7">
    <!-- Table -->
    <div class="row">
      <div class="col">
        <div class="card shadow">
          <div class="card-header border-0">
            <h3 class="mb-0 text-center">Submission Summary</h3>
          </div>
          <div class="col-sm-4 text-center">
            <span class="badge badge-primary">{{username}}</span>
          </div>
           <div class="card-body">
            
            <div style="width: 20rem;">
              <div class="card card-stats mb-4 mb-lg-0">
                <div class="card-body">
                    <div class="row align-items-center">
                      <div class="col">
                        <h5>Project: {{projectName}}</h5>
                        <h5>Slab: {{sprojectfloor}}</h5>
                        <h5>Pour: {{sprojectpour}}</h5>
                        <h5>Worktype: {{sworktype}}</h5>
                        <h5 class="btn-warning">Worker Count: </h5>
                        <h5 class="btn-danger">Company Worker - {{companyWorker ?? 0}}</h5>
                        <h5 class="btn-danger">Contract Worker - {{contractWorker ?? 0}}</h5>
                        <h5 class="btn-danger">Other Worker - {{others ?? 0}}</h5>                        
                      </div>
                    </div>
                </div>
              </div>
            </div>
        </div>
        <div class="col-sm-8 text-center">
          <span style="cursor: pointer;" class="badge badge-warning text-center" [routerLink]="['/home']">Back to Home</span>
        </div>
        </div>
      </div>
    </div>
  </div>
  </div>
    
  
